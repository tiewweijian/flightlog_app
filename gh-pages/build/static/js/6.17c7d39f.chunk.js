(this["webpackJsonpwindmill-dashboard-react"]=this["webpackJsonpwindmill-dashboard-react"]||[]).push([[6],{61:function(e,a,t){"use strict";t.r(a);var l=t(0),n=t.n(l),r=t(13),o=t(14);var s=()=>{const{isAdminControlOpen:e,setIsAdminControlOpen:a}=Object(l.useContext)(o.a);return n.a.createElement(r.Button,{className:"flex items-center justify-between p-4 mb-8 text-sm font-semibold text-purple-100 bg-purple-600 rounded-lg shadow-md focus:outline-none focus:shadow-outline-purple",onClick:()=>a(!0)},n.a.createElement("div",{className:"flex items-center"},n.a.createElement("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},n.a.createElement("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})),n.a.createElement("span",null,"View Admin Controls")),n.a.createElement("span",null,n.a.createElement("span",{dangerouslySetInnerHTML:{__html:"&RightArrow;"}})))};var c=function(e){let{children:a}=e;return n.a.createElement("h1",{className:"my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200"},a)},m=t(37),u=t(44),i=t.n(u),d=t(59),E=t(36);var b=e=>{let{isModalOpen:a,setModalStatus:t}=e;const[s,c]=Object(l.useState)(""),[m,u]=Object(l.useState)(""),[i,b]=Object(l.useState)(!1),{token:g,storeToken:p,removeToken:h}=Object(l.useContext)(o.a),{isLoginModalOpen:f,setIsLoginModalOpen:C,tableData:v,setTableData:w,isAdmin:T,setIsAdmin:y}=Object(l.useContext)(o.a),O=()=>{c(""),u(""),C(!1)};return n.a.createElement(r.Modal,{isOpen:f,onClose:O},n.a.createElement(r.ModalHeader,null,"Login"),n.a.createElement("form",{onSubmit:async e=>{e.preventDefault();try{const e=await d.a.post(E.f,{username:s,password:m});1==e.data.status&&(p(e.data.token),console.log(e.data.token));try{const a=await d.a.get(E.d,{headers:{"x-auth-token":e.data.token}});console.log(a.data),w(a.data)}catch(a){console.log(a)}O();try{1==(await d.a.get(E.e,{headers:{"x-auth-token":e.data.token}})).data.isAdmin&&y(!0)}catch(a){y(!1)}O()}catch(a){b(!0),console.error("Error submitting form:",a)}}},n.a.createElement(r.ModalBody,null,n.a.createElement("div",{className:"hidden sm:block"},n.a.createElement(r.Label,null,n.a.createElement("span",null,"Username"),i?n.a.createElement(r.Input,{className:"mt-1",value:s,valid:!1,onChange:e=>c(e.target.value)}):n.a.createElement(r.Input,{className:"mt-1",value:s,onChange:e=>c(e.target.value)}))),n.a.createElement("div",{className:"hidden sm:block pt-5"},n.a.createElement(r.Label,null,n.a.createElement("span",null,"Password"),i?n.a.createElement(r.Input,{className:"mt-1",type:"password",value:m,valid:!1,onChange:e=>u(e.target.value)}):n.a.createElement(r.Input,{className:"mt-1",type:"password",value:m,onChange:e=>u(e.target.value)})))),n.a.createElement(r.ModalFooter,null,n.a.createElement("div",null,n.a.createElement(r.Button,{type:"submit"},"Login")))))},g=t(45);t(39),t(40);var p=()=>{const{token:e,editData:a,setIsEditLogOpen:t,setTableData:s,isEditLogOpen:c}=Object(l.useContext)(o.a),[m,u]=Object(l.useState)(""),[i,b]=Object(l.useState)(""),[p,h]=Object(l.useState)(new Date),[f,C]=Object(l.useState)(new Date),[v,w]=Object(l.useState)("");Object(l.useEffect)(()=>{if(a){const e=new Date(a.takeoff),t=new Date(a.landing);isNaN(e.getTime())||h(e),isNaN(t.getTime())||C(t),u(a.tailNumber||""),b(a.flightID||""),w(a.duration||"")}},[a]);const T=(e,a)=>((a.getTime()-e.getTime())/36e5).toFixed(1),y=()=>{t(!1)};return n.a.createElement(r.Modal,{isOpen:c,onClose:y,style:{overflow:"visible"}},n.a.createElement(r.ModalHeader,null,"Edit Flight Log"),n.a.createElement("form",{onSubmit:async t=>{t.preventDefault(),y();const l={tailNumber:m,flightID:i,takeoff:p.toISOString(),landing:f.toISOString(),duration:v};try{await d.a.put(E.h+a._id,l,{headers:{"x-auth-token":e,"Content-Type":"application/json"}});const t=await d.a.get(E.d,{headers:{"x-auth-token":e}});s(t.data)}catch(n){console.error("Error updating flight log:",n)}}},n.a.createElement(r.ModalBody,null,n.a.createElement("div",{className:"hidden sm:block"},n.a.createElement(r.Label,null,n.a.createElement("span",null,"Tail Number"),n.a.createElement(r.Input,{className:"mt-1",value:m,onChange:e=>u(e.target.value)}))),n.a.createElement("div",null,n.a.createElement(r.Label,null,n.a.createElement("span",null,"Takeoff"),n.a.createElement(g.a,{value:p,onChange:e=>{if(e&&(h(e),f)){const a=T(e,f);w(a)}},className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}))),n.a.createElement("div",null,n.a.createElement(r.Label,null,n.a.createElement("span",null,"Landing"),n.a.createElement(g.a,{value:f,onChange:e=>{if(e&&(C(e),p)){const a=T(p,e);w(a)}},minDate:p,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}))),n.a.createElement("div",{className:"hidden sm:block"},n.a.createElement(r.Label,null,n.a.createElement("span",null,"Duration"),n.a.createElement(r.Input,{className:"mt-1",value:v,readOnly:!0})))),n.a.createElement(r.ModalFooter,null,n.a.createElement("div",null,n.a.createElement(r.Button,{type:"submit"},"Confirm Changes")))))};var h=()=>{const{token:e,isCreateAccountOpen:a,setIsCreateAccountOpen:t,setUserData:s}=Object(l.useContext)(o.a),[c,m]=Object(l.useState)(""),[u,i]=Object(l.useState)(""),[b,g]=Object(l.useState)(""),[p,h]=Object(l.useState)(!1),[f,C]=Object(l.useState)(!1),v=()=>{t(!1)};return n.a.createElement(r.Modal,{isOpen:a,onClose:v},n.a.createElement(r.ModalHeader,null,"Create Account"),n.a.createElement("form",{onSubmit:async a=>{if(a.preventDefault(),u!=b)alert("Different Password"),C(!0);else if("admin"==c.toLocaleLowerCase())alert("Username not allowed"),h(!0);else{const a={username:c,password:u};try{const l=await d.a.post(E.i,a);console.log(l.data),alert("Account created"),v();try{const a=await d.a.get(E.c,{headers:{"x-auth-token":e}});console.log(a.data),s(a.data)}catch(t){console.log(t)}}catch(t){"User already exists"==t.response.data.msg&&(alert("Username is used"),h(!0)),console.error("Error updating flight log:",t)}}}},n.a.createElement(r.ModalBody,null,n.a.createElement("div",{className:"hidden sm:block"},n.a.createElement(r.Label,null,n.a.createElement("span",null,"Username"),p?n.a.createElement(r.Input,{className:"mt-1",valid:!1,value:c,onChange:e=>m(e.target.value)}):n.a.createElement(r.Input,{className:"mt-1",value:c,onChange:e=>m(e.target.value)}))),n.a.createElement("div",{className:"hidden sm:block"},n.a.createElement(r.Label,null,n.a.createElement("span",null,"Password"),f?n.a.createElement(r.Input,{className:"mt-1",type:"password",valid:!1,value:u,onChange:e=>i(e.target.value)}):n.a.createElement(r.Input,{className:"mt-1",type:"password",value:u,onChange:e=>i(e.target.value)}))),n.a.createElement("div",{className:"hidden sm:block"},n.a.createElement(r.Label,null,n.a.createElement("span",null,"Password"),f?n.a.createElement(r.Input,{className:"mt-1",type:"password",valid:!1,value:b,onChange:e=>g(e.target.value)}):n.a.createElement(r.Input,{className:"mt-1",type:"password",value:b,onChange:e=>g(e.target.value)})))),n.a.createElement(r.ModalFooter,null,n.a.createElement("div",null,n.a.createElement(r.Button,{type:"submit"},"Create Account")))))};var f=e=>{let{isModalOpen:a,setModalStatus:t}=e;const{token:s,storeToken:c,removeToken:u}=Object(l.useContext)(o.a),{isLoginModalOpen:b,setIsLoginModalOpen:g,tableData:p,setTableData:h,isAdminControlOpen:f,setIsAdminControlOpen:C,userData:v,setUserData:w}=Object(l.useContext)(o.a);Object(l.useEffect)(()=>{s&&(async()=>{try{const e=await d.a.get(E.c,{headers:{"x-auth-token":s}});console.log(e.data),w(e.data)}catch(e){console.error("Error fetching users:",e)}})()},[s]);const T=async(e,a)=>{if("YES"==await(async()=>(await i.a.fire({title:"You are deleting this user and cannot be recovered",icon:"warning",showCancelButton:!0,confirmButtonText:"YES",cancelButtonText:"NO"})).isConfirmed?"YES":"NO")())try{await d.a.delete(E.b+e._id,{headers:{"x-auth-token":a}});try{const e=await d.a.get(E.c,{headers:{"x-auth-token":a}});console.log(e.data),w(e.data)}catch(t){console.log(t)}}catch(t){console.error("Error deleting the flight log:",t)}};return n.a.createElement(r.Modal,{isOpen:f,onClose:()=>{C(!1)}},n.a.createElement(r.ModalHeader,null,"Delete Users"),n.a.createElement(r.ModalBody,null,n.a.createElement(r.TableContainer,null,n.a.createElement(r.Table,null,n.a.createElement(r.TableHeader,null,n.a.createElement("tr",null,n.a.createElement(r.TableCell,null,"Username"),n.a.createElement(r.TableCell,null,"ID"),n.a.createElement(r.TableCell,null))),n.a.createElement(r.TableBody,null,v.map((e,a)=>n.a.createElement(r.TableRow,{key:a},n.a.createElement(r.TableCell,null,n.a.createElement("div",{className:"flex items-center text-sm"},n.a.createElement("p",{className:"font-semibold"},e.username))),n.a.createElement(r.TableCell,null,n.a.createElement("span",{className:"text-sm"},e._id)),n.a.createElement(r.TableCell,null,"admin"==e.username?"":n.a.createElement(r.Button,{icon:m.TrashIcon,"aria-label":"Edit",onClick:()=>T(e,s)})))))))),n.a.createElement(r.ModalFooter,null))};a.default=function(){const[e,a]=Object(l.useState)(1),[t,u]=Object(l.useState)([]),{isLoginModalOpen:g,setIsLoginModalOpen:C,token:v,tableData:w,setEditData:T,setIsEditLogOpen:y,setTableData:O,searchText:N,isAdmin:x,setIsAdmin:k}=Object(l.useContext)(o.a),S=w.length,I=e=>{const a=new Date(e);return new Intl.DateTimeFormat("en-SG",{timeZone:"Asia/Singapore",dateStyle:"short",timeStyle:"short"}).format(a)};Object(l.useEffect)(()=>{if(""==N.trim())u(w.slice(10*(e-1),10*e));else{const a=w.filter(e=>e.tailNumber.toLowerCase().includes(N.toLowerCase())||e.flightID.toLowerCase().includes(N.toLowerCase()));u(a.slice(10*(e-1),10*e))}},[e,w,N]),Object(l.useEffect)(()=>{v||C(!0)},[v]);const D=async(e,a)=>{if("YES"==await(async()=>(await i.a.fire({title:"You are deleting this flight log, and cannot be recovered. Proceed?",icon:"warning",showCancelButton:!0,confirmButtonText:"YES",cancelButtonText:"NO"})).isConfirmed?"YES":"NO")())try{await d.a.delete(E.a+e._id,{headers:{"x-auth-token":a}});try{const e=await d.a.get(E.d,{headers:{"x-auth-token":a}});console.log(e.data),O(e.data)}catch(t){console.log(t)}}catch(t){console.error("Error deleting the flight log:",t)}};return n.a.createElement(n.a.Fragment,null,n.a.createElement(c,null,"Summary"),x?n.a.createElement(s,null):"",n.a.createElement(b,null),n.a.createElement(p,null),n.a.createElement(f,null),n.a.createElement(h,null),v?n.a.createElement(r.TableContainer,null,n.a.createElement(r.Table,null,n.a.createElement(r.TableHeader,null,n.a.createElement("tr",null,n.a.createElement(r.TableCell,null,"Tail Number"),n.a.createElement(r.TableCell,null,"Flight ID"),n.a.createElement(r.TableCell,null,"Take Off"),n.a.createElement(r.TableCell,null,"Landing"),n.a.createElement(r.TableCell,null,"Duration"),n.a.createElement(r.TableCell,null),n.a.createElement(r.TableCell,null))),n.a.createElement(r.TableBody,null,t.map((e,a)=>n.a.createElement(r.TableRow,{key:a},n.a.createElement(r.TableCell,null,n.a.createElement("div",{className:"flex items-center text-sm"},n.a.createElement("p",{className:"font-semibold"},e.tailNumber))),n.a.createElement(r.TableCell,null,n.a.createElement("span",{className:"text-sm"},e.flightID)),n.a.createElement(r.TableCell,null,n.a.createElement("span",{className:"text-sm"},I(e.takeoff))),n.a.createElement(r.TableCell,null,n.a.createElement("span",{className:"text-sm"},I(e.landing))),n.a.createElement(r.TableCell,null,n.a.createElement("span",{className:"text-sm"},e.duration)),n.a.createElement(r.TableCell,null,n.a.createElement(r.Button,{icon:m.EditIcon,"aria-label":"Edit",onClick:()=>{return a=e,console.log(a),T(a),void y(!0);var a}})),n.a.createElement(r.TableCell,null,n.a.createElement(r.Button,{icon:m.TrashIcon,"aria-label":"Edit",onClick:()=>D(e,v)})))))),n.a.createElement(r.TableFooter,null,n.a.createElement(r.Pagination,{totalResults:S,resultsPerPage:10,label:"Table navigation",onChange:function(e){a(e)}}))):n.a.createElement(r.Card,null,n.a.createElement(r.CardBody,null,n.a.createElement("p",{className:"mb-4 font-semibold text-gray-600 dark:text-gray-300"},"Log in to view data"),n.a.createElement("p",{className:"text-gray-600 dark:text-gray-400"},"Restricted access to flight log data"))))}}}]);
//# sourceMappingURL=6.17c7d39f.chunk.js.map